package com.meli.currency.service;

import java.sql.Timestamp;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.meli.currency.DateHelper;
import com.meli.currency.exception.CurrencyConfigurationNotFoundException;
import com.meli.currency.exception.ParamMandatoryException;
import com.meli.currency.model.CurrencyConversion;
import com.meli.currency.repository.CurrencyConversionRepository;


@Service
public class CurrencyService {

	@Autowired
	private CurrencyConversionRepository currencyRepo;

	public Double convertToCurrencyDefault(String name, Double amount) {
		if(name == null || name.trim().isEmpty()) {
			throw new ParamMandatoryException("name no puede ser null");
		}
		if(amount == null || amount < 0) {
			throw new ParamMandatoryException("amount no puede ser null ni negativo");
		}
	
		List<CurrencyConversion> allDefaults = currencyRepo.findByDefault();
		if(allDefaults.isEmpty()) {
			throw new CurrencyConfigurationNotFoundException("No se encontr贸 una configuraci贸n default");
		}
		
		List<CurrencyConversion> currencyConversionList = currencyRepo.findByName(name);
		if(currencyConversionList.isEmpty()) {
			throw new CurrencyConfigurationNotFoundException(String.format("No se encontr贸 una configuraci贸n para el currency '%s'", name));
		}

		Timestamp now = DateHelper.getInstance().getNow();
		for(CurrencyConversion cc : currencyConversionList) {
			if(cc.isBetween(now)) {
//				return cc.convert(amount);
			}
		}
		return null;
	}

}