package com.meli.charge;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Example;
import org.springframework.stereotype.Service;

import com.meli.charge.model.Bill;
import com.meli.charge.repository.BillRepository;

@Service
public class BillService {

	@Autowired
	private BillRepository billRepo;
	
	public Bill getCurrentBuild(Integer userId, Integer month, Integer year) {
		Bill bExample = new Bill();
		bExample.setUserId(userId);
		bExample.setMonth(month);
		bExample.setYear(year);
		List<Bill> bills = billRepo.findAll(Example.of(bExample));
		if(bills.isEmpty()) {
			return null;
		} else if(bills.size() > 1) {
			throw new IllegalStateException(String.format("Existe más de una factura para el mes '%d' y año '%d' asociada al usuario '%d'", month, year, userId));
		} else {
			return bills.iterator().next();
		}
	}

	public Bill save(Bill bill) {
		return billRepo.save(bill);
	}

}
