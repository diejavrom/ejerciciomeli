package com.meli.charge;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.meli.charge.model.Bill;
import com.meli.charge.repository.BillRepository;

@Service
public class BillService {

	@Autowired
	private BillRepository billRepo;
	
	public Bill getBillByUserMonthYear(Integer userId, Integer month, Integer year) {
		List<Bill> bills = billRepo.findByUserIdMonthYear(userId, month, year);
		if(bills.isEmpty()) {
			return null;
		} else if(bills.size() > 1) {
			throw new IllegalStateException(String.format("Existe más de una factura para el mes '%d' y año '%d' asociada al usuario '%d'", month, year, userId));
		} else {
			return bills.iterator().next();
		}
	}

	public Bill save(Bill bill) {
		return billRepo.save(bill);
	}

	public List<Bill> getBills(Integer user_id) {
		return billRepo.findByUserId(user_id);
	}

}